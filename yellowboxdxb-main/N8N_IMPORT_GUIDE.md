# Yellow Box - n8n Workflow Import & Configuration Guide

## üéØ Step-by-Step: Import Complete Workflows into n8n

This guide walks you through importing the complete workflow files into your n8n instance and configuring them properly.

## üìã Prerequisites

Before starting, ensure you have:
- ‚úÖ n8n running at http://localhost:5678
- ‚úÖ Google Cloud project set up
- ‚úÖ Google Sheets created with required tabs
- ‚úÖ Service account JSON file downloaded
- ‚úÖ Firebase Admin SDK JSON file downloaded

## üöÄ Step 1: Start n8n and Access Interface

1. **Start n8n** (if not already running):
   ```bash
   ./scripts/deploy-automation.sh
   ```

2. **Open n8n interface**:
   - Go to: http://localhost:5678
   - Set up your n8n account (first time only)

## üîê Step 2: Set Up Credentials in n8n

### Google Sheets API Credential

1. **In n8n interface**:
   - Click "Credentials" in left sidebar
   - Click "Add Credential"
   - Search for "Google Sheets API"
   - Select "Service Account"

2. **Configure the credential**:
   - **Name**: `YellowBox Google Sheets`
   - **Service Account Email**: (from your JSON file)
   - **Private Key**: Upload your Google Cloud service account JSON file
   - Click "Save"

### Google API Credential (for Firebase)

1. **Add another credential**:
   - Click "Add Credential"
   - Search for "Google API"
   - Select "Service Account"

2. **Configure the credential**:
   - **Name**: `Google API`
   - **Service Account Email**: (from your Firebase JSON file)
   - **Private Key**: Upload your Firebase Admin SDK JSON file
   - Click "Save"

## üì• Step 3: Import Workflow Files

### Import Each Workflow

1. **Go to Workflows tab** in n8n
2. **Click "Add Workflow"**
3. **Click "Import from file"**
4. **Select workflow files** one by one from `n8n-workflows/` directory:

   - `real-time-data-sync.json`
   - `scheduled-data-backup.json`
   - `health-monitoring.json`
   - `data-integrity-check.json`

5. **Each workflow will import with all nodes visible!**

## ‚öôÔ∏è Step 4: Configure Each Workflow

### For ALL Workflows - Replace Placeholders:

1. **Open each imported workflow**
2. **Find and replace these values**:

   **Google Sheets Configuration:**
   - Find: `YOUR_GOOGLE_SHEET_ID`
   - Replace with: Your actual Google Sheet ID (from the URL)
   - Find: `YOUR_GOOGLE_SHEETS_CREDENTIAL_ID`
   - Replace with: `YellowBox Google Sheets`

   **Firebase Configuration:**
   - Find: `YOUR_GOOGLE_API_CREDENTIAL_ID`
   - Replace with: `Google API`

   **EmailJS Configuration (for alerts):**
   - Find: `YOUR_EMAILJS_SERVICE_ID`
   - Replace with: Your EmailJS service ID (optional)
   - Find: `YOUR_EMAILJS_TEMPLATE_ID`
   - Replace with: Your EmailJS template ID (optional)
   - Find: `YOUR_EMAILJS_USER_ID`
   - Replace with: Your EmailJS user ID (optional)

### Workflow-Specific Configuration:

#### 1. Real-time Data Sync Workflow
- **Webhook URL**: Will be auto-generated by n8n
- **Note the webhook URL** for later integration with your app
- **Test**: Click "Execute Workflow" to test

#### 2. Scheduled Data Backup Workflow
- **Schedule**: Set to run every 6 hours (already configured)
- **Firebase URLs**: Already set to your project (yellowbox-8e0e6)
- **Test**: Click "Execute Workflow" to test

#### 3. Health Monitoring Workflow
- **Schedule**: Set to run every 15 minutes (already configured)
- **App URL**: Already set to https://yellowbox-8e0e6.web.app
- **Test**: Click "Execute Workflow" to test

#### 4. Data Integrity Check Workflow
- **Schedule**: Set to run daily at midnight (already configured)
- **Firebase URLs**: Already set to your project
- **Test**: Click "Execute Workflow" to test

## üß™ Step 5: Test Each Workflow

### Test Process for Each Workflow:

1. **Open the workflow**
2. **Click "Execute Workflow"** button
3. **Check execution results**:
   - Green = Success
   - Red = Error (check error details)
4. **Verify data appears in Google Sheets**
5. **Fix any configuration issues**

### Expected Results:

- **Real-time Sync**: Should create webhook URL
- **Scheduled Backup**: Should fetch data from Firebase and backup to sheets
- **Health Monitoring**: Should check app health and log results
- **Data Integrity**: Should validate data and report status

## üöÄ Step 6: Activate Workflows

### Once All Tests Pass:

1. **For each workflow**:
   - Toggle the "Active" switch to ON
   - Workflow will start running automatically

2. **Monitor execution**:
   - Go to "Executions" tab
   - Watch for successful runs
   - Check Google Sheets for data updates

## üìä Step 7: Verify Integration

### Check Your Google Sheets:

1. **Open your Google Spreadsheet**
2. **Verify these tabs have data**:
   - `Riders_Backup` - Should have rider data
   - `Expenses_Backup` - Should have expense data
   - `Documents_Backup` - Should have document data
   - `Health_Log` - Should have health check results
   - `Data_Integrity_Log` - Should have integrity check results

### Check Webhook Integration:

1. **Get webhook URL** from Real-time Sync workflow
2. **Test webhook** with curl:
   ```bash
   curl -X POST http://localhost:5678/webhook/yellowbox-sync \
     -H "Content-Type: application/json" \
     -d '{
       "type": "rider",
       "id": "test123",
       "action": "created",
       "data": {
         "id": "test123",
         "name": "Test Rider",
         "email": "test@example.com",
         "status": "active"
       }
     }'
   ```

3. **Check Google Sheets** - Should see test data in Riders tab

## üîß Troubleshooting

### Common Issues:

**1. Credential Errors:**
- Verify service account JSON files are uploaded correctly
- Check Google Sheets is shared with service account email
- Ensure APIs are enabled in Google Cloud Console

**2. Workflow Execution Errors:**
- Check Google Sheet ID is correct
- Verify sheet tab names match exactly
- Check Firebase project ID is correct

**3. No Data in Sheets:**
- Verify workflows are activated
- Check execution logs for errors
- Test individual nodes in workflows

**4. Webhook Not Working:**
- Check webhook URL is accessible
- Verify payload format matches expected structure
- Check n8n is running and accessible

### Debug Steps:

1. **Check n8n logs**:
   ```bash
   tail -f n8n.log
   ```

2. **Test individual nodes**:
   - Click on any node in workflow
   - Click "Execute Node" to test individually

3. **Check Google Sheets permissions**:
   - Verify service account has Editor access
   - Check sheet tab names are exactly as expected

4. **Validate workflow structure**:
   ```bash
   ./validate-workflows.sh
   ```

## üìà Monitoring Your Automation

### Daily Monitoring:

1. **Check execution history** in n8n
2. **Review Google Sheets** for data updates
3. **Monitor health logs** for any issues
4. **Check integrity reports** for data consistency

### Use Monitoring Script:

```bash
./monitor-workflows.sh
```

This will show:
- n8n process status
- Recent activity logs
- Quick links to n8n interface
- Troubleshooting tips

## üéâ Success Indicators

Your automation is working correctly when you see:

- ‚úÖ All 4 workflows showing as "Active" in n8n
- ‚úÖ Regular executions in the "Executions" tab
- ‚úÖ Data appearing in Google Sheets backup tabs
- ‚úÖ Health monitoring logs being created
- ‚úÖ Data integrity checks running daily
- ‚úÖ Real-time sync working when you test the webhook

## üìö Additional Resources

- **Detailed Setup**: `CREDENTIAL_SETUP_GUIDE.md`
- **Quick Start**: `QUICK_START_AUTOMATION.md`
- **Tmux Environment**: `TMUX_AUTOMATION_GUIDE.md`
- **Workflow Validation**: `validate-workflows.sh`

Your Yellow Box automation system is now fully operational! üöÄ